{"failedCount":0,"prefixedPath":"features\/test_except_distinct_deltaload.feature","packageQualifiedName":"features.test_except_distinct_deltaload","loopIndex":-1,"relativePath":"features\/test_except_distinct_deltaload.feature","scenarioResults":[{"sectionIndex":0,"stepResults":[{"result":{"nanos":4283590,"startTime":1771318142435,"endTime":1771318142439,"millis":4.28359,"status":"passed"},"step":{"background":true,"line":4,"prefix":"*","index":0,"text":"def query = 'except_distinct_deltaload'"}},{"result":{"nanos":161884731,"startTime":1771318142480,"endTime":1771318142642,"millis":161.884731,"status":"passed"},"step":{"background":true,"line":5,"prefix":"*","index":1,"text":"def tablename = karate.properties['tablename'] ? karate.properties['tablename'] : '*'"}},{"result":{"nanos":17819211,"startTime":1771318142643,"endTime":1771318142661,"millis":17.819211,"status":"passed"},"step":{"background":true,"line":6,"prefix":"*","index":2,"text":"def pythonCmd = buildPythonCmd(query, tablename)"}},{"result":{"nanos":78863444,"startTime":1771318142661,"endTime":1771318142740,"millis":78.863444,"status":"passed"},"step":{"background":true,"line":7,"prefix":"*","index":3,"text":"print 'Inside except_distinct.feature: pythonCmd ===> ',pythonCmd"},"stepLog":"14:19:02.738 [print] Inside except_distinct.feature: pythonCmd ===>  python src\/main\/python\/run_query.py --query except_distinct_deltaload --tablename * \n"},{"result":{"nanos":22206965238,"startTime":1771318142742,"endTime":1771318164949,"millis":22206.965238,"status":"passed"},"step":{"line":11,"prefix":"*","index":0,"text":"call read('run-query.feature')"},"callResults":[{"failedCount":0,"prefixedPath":"features\/run-query.feature","packageQualifiedName":"features.run-query","loopIndex":-1,"relativePath":"features\/run-query.feature","scenarioResults":[{"sectionIndex":0,"stepResults":[{"result":{"nanos":75416255,"startTime":1771318142791,"endTime":1771318142866,"millis":75.416255,"status":"passed"},"step":{"comments":["# Run the Python script"],"line":5,"prefix":"*","index":0,"text":"print 'Inside run-query.feature: pythonCmd ===> ', pythonCmd"},"stepLog":"14:19:02.866 [print] Inside run-query.feature: pythonCmd ===>  python src\/main\/python\/run_query.py --query except_distinct_deltaload --tablename * \n"},{"result":{"nanos":22065896347,"startTime":1771318142867,"endTime":1771318164933,"millis":22065.896347,"status":"passed"},"step":{"line":6,"prefix":"*","index":1,"text":"def result = karate.exec(pythonCmd)"}},{"result":{"nanos":9105394,"startTime":1771318164933,"endTime":1771318164942,"millis":9.105394,"status":"passed"},"step":{"line":7,"prefix":"*","index":2,"text":"print 'result ===> ', result"},"stepLog":"14:19:24.941 [print] result ===>  Starting query execution framework...Running query: except_distinct_deltaloadâ\u2013¶ Generated SQL:WITH table_info AS  (SELECT table_catalog,          table_schema,          TABLE_NAME,          STRING_AGG(CONCAT('`', COLUMN_NAME, '`'), ','                     ORDER BY ordinal_position) AS columns   FROM `ncau-data-newsquery-prd.sdm_optima_dgw.INFORMATION_SCHEMA.COLUMNS`   WHERE COLUMN_NAME NOT IN ('nq_batch_id',                             'dgw_batch_id',                             'dw_batch_id',                             'dw_ingest_time',                             'dw_partition_date',                             'dw_publish_time',                             'dw_source_object_name',                             'soft_error_fields',                             'extra_data_payload')     AND TABLE_NAME NOT IN ('appc_send_log',                            'appc_send_log_0715',                            'contactsf',                            'emailobject',                            'pushmessagedetail',                            'smsdetailsummary',                            'cart',                            'order')     AND TABLE_NAME IN ('customer',                        'customer_address',                        'customer_address_ext',                        'customer_ext',                        'demographic',                        'news_customer_contract',                        'news_demographic_ex',                        'news_ext_customer_redemption',                        'news_financial_transaction',                        'news_interactions',                        'news_payment_account_ext',                        'order_item',                        'order_item_ext',                        'order_item_note',                        'paybreak',                        'payment',                        'payment_account',                        'payment_reversed_payment',                        'service',                        'service_ext',                        'gbaba_act_xref',                        'audit_extract',                        'pagination_extract',                        'payonscan_bluebook_ext',                        'rcti_7eleven_bluebook_ext',                        'rcti_caltex_bluebook_ext',                        'rcti_coles_bluebook_ext',                        'rcti_coles_sm_bluebook_ext',                        'rcti_woolies_bluebook_exts',                        'ad_custom_fields_export',                        'customers_export',                        'display_ads_export',                        'insert_ads_export',                        'online_ad_export2',                        'order_custom_fields_export',                        'order_export2',                        'order_item_audience_segment',                        'order_item_metadata',                        'order_item_price_item',                        'order_items')   GROUP BY table_catalog,            table_schema,            TABLE_NAME)SELECT 'SIT-prod' AS scenario,       TABLE_NAME,       CONCAT('SELECT \"', TABLE_NAME, '\" AS table_name, ', columns, ' FROM `', 'ncau-data-newsquery-sit', '.', 'sdm_optima', '.', TABLE_NAME, '` ', 'WHERE dw_partition_date BETWEEN \"', '2026-02-16', '\" AND \"', '2026-02-16', '\" ', ' EXCEPT DISTINCT ', 'SELECT \"', TABLE_NAME, '\" AS table_name, ', columns, ' FROM `', 'ncau-data-newsquery-prd', '.', 'sdm_optima_dgw', '.', TABLE_NAME, '` ', 'WHERE dw_partition_date BETWEEN \"', '2026-02-16', '\" AND \"', '2026-02-16', '\";') AS testcaseFROM table_infoUNION ALLSELECT 'prod-SIT' AS scenario,       TABLE_NAME,       CONCAT('SELECT \"', TABLE_NAME, '\" AS table_name, ', columns, ' FROM `', 'ncau-data-newsquery-prd', '.', 'sdm_optima_dgw', '.', TABLE_NAME, '` ', 'WHERE dw_partition_date BETWEEN \"', '2026-02-16', '\" AND \"', '2026-02-16', '\" ', ' EXCEPT DISTINCT ', 'SELECT \"', TABLE_NAME, '\" AS table_name, ', columns, ' FROM `', 'ncau-data-newsquery-sit', '.', 'sdm_optima', '.', TABLE_NAME, '` ', 'WHERE dw_partition_date BETWEEN \"', '2026-02-16', '\" AND \"', '2026-02-16', '\";') AS testcaseFROM table_infoORDER BY TABLE_NAME;Executing query... | (0.0s)Executing query... \/ (0.1s)Executing query... - (0.4s)Executing query... \\ (0.5s)Executing query... | (0.6s)Executing query... \/ (0.7s)Executing query... - (0.8s)Executing query... \\ (0.9s)Executing query... | (1.0s)Executing query... \/ (1.1s)Executing query... - (1.2s)Executing query... \\ (1.3s)Executing query... | (1.4s)Executing query... \/ (1.5s)Executing query... - (1.7s)Executing query... \\ (1.8s)Executing query... | (1.9s)Executing query... \/ (2.0s)Executing query... - (2.1s)D:\\Users\\ganesany\\AppData\\Roaming\\Python\\Python311\\site-packages\\google\\cloud\\bigquery\\table.py:1994: UserWarning: BigQuery Storage module not found, fetch data with the REST endpoint instead.  warnings.warn(Executing query... \\ (2.3s)Executing query... | (2.4s)Executing query... \/ (2.5s)Executing query... - (2.6s)                                             âœ\u2026 Running testcases for tables starting with ''Executing EXCEPT DISTINCT testcases...â\u2013¶â\u2013¶â\u2013¶ Running testcase [prod-SIT] for table â\u2020\u2019 audit_extract â\u2013¶â\u2013¶â\u2013¶â\u2013¶ Generated SQL:SELECT \"audit_extract\" AS TABLE_NAME,       `wlkDatabaseID`,       `srcDatabase`FROM `ncau-data-newsquery-prd.sdm_optima_dgw.audit_extract`WHERE dw_partition_date BETWEEN \"2026-02-16\" AND \"2026-02-16\"EXCEPT DISTINCTSELECT \"audit_extract\" AS TABLE_NAME,       `wlkDatabaseID`,       `srcDatabase`FROM `ncau-data-newsquery-sit.sdm_optima.audit_extract`WHERE dw_partition_date BETWEEN \"2026-02-16\" AND \"2026-02-16\";--------------------------------------------------------------------------------Executing query... | (0.0s)Executing query... \/ (0.1s)Executing query... - (0.2s)Executing query... \\ (0.3s)Executing query... | (0.4s)Executing query... \/ (0.5s)Executing query... - (0.6s)Executing query... \\ (0.7s)Executing query... | (1.3s)Executing query... \/ (1.6s)Executing query... - (1.7s)Executing query... \\ (1.9s)                                             âš ï¸� Saved failing SQL â\u2020\u2019 output\/failed_testcases\\prod-SIT_audit_extract.sqlâ�Œ Testcase failed â\u2020\u2019 1677 differing row(s) foundâ\u2013¶â\u2013¶â\u2013¶ Running testcase [SIT-prod] for table â\u2020\u2019 audit_extract â\u2013¶â\u2013¶â\u2013¶â\u2013¶ Generated SQL:SELECT \"audit_extract\" AS TABLE_NAME,       `wlkDatabaseID`,       `srcDatabase`FROM `ncau-data-newsquery-sit.sdm_optima.audit_extract`WHERE dw_partition_date BETWEEN \"2026-02-16\" AND \"2026-02-16\"EXCEPT DISTINCTSELECT \"audit_extract\" AS TABLE_NAME,       `wlkDatabaseID`,       `srcDatabase`FROM `ncau-data-newsquery-prd.sdm_optima_dgw.audit_extract`WHERE dw_partition_date BETWEEN \"2026-02-16\" AND \"2026-02-16\";--------------------------------------------------------------------------------Executing query... | (0.0s)Executing query... \/ (0.1s)Executing query... - (0.3s)Executing query... \\ (0.4s)Executing query... | (0.5s)Executing query... \/ (0.6s)Executing query... - (0.7s)Executing query... \\ (0.8s)Executing query... | (0.9s)Executing query... \/ (1.0s)Executing query... - (1.1s)Executing query... \\ (1.2s)Executing query... | (1.3s)D:\\Users\\ganesany\\AppData\\Roaming\\Python\\Python311\\site-packages\\google\\cloud\\bigquery\\table.py:1994: UserWarning: BigQuery Storage module not found, fetch data with the REST endpoint instead.  warnings.warn(Executing query... \/ (1.4s)Executing query... - (1.5s)Executing query... \\ (1.6s)Executing query... | (1.7s)                                             âœ\u201D Testcase passed â\u2020\u2019 no differences foundâ\u2013¶â\u2013¶â\u2013¶ Running testcase [prod-SIT] for table â\u2020\u2019 pagination_extract â\u2013¶â\u2013¶â\u2013¶â\u2013¶ Generated SQL:SELECT \"pagination_extract\" AS TABLE_NAME,       `PublisherCode`,       `PublicationCode`,       `PublicationName`,       `OptimaLinkToEdition`,       `EditionDate`,       `EditionPageCount`,       `SectionName`,       `SectionCode`,       `SectionPageCount`,       `IDEditionVersion`,       `Description`,       `srcDatabase`FROM `ncau-data-newsquery-prd.sdm_optima_dgw.pagination_extract`WHERE dw_partition_date BETWEEN \"2026-02-16\" AND \"2026-02-16\"EXCEPT DISTINCTSELECT \"pagination_extract\" AS TABLE_NAME,       `PublisherCode`,       `PublicationCode`,       `PublicationName`,       `OptimaLinkToEdition`,       `EditionDate`,       `EditionPageCount`,       `SectionName`,       `SectionCode`,       `SectionPageCount`,       `IDEditionVersion`,       `Description`,       `srcDatabase`FROM `ncau-data-newsquery-sit.sdm_optima.pagination_extract`WHERE dw_partition_date BETWEEN \"2026-02-16\" AND \"2026-02-16\";--------------------------------------------------------------------------------Executing query... | (0.0s)Executing query... \/ (0.1s)Executing query... - (0.2s)Executing query... \\ (0.3s)Executing query... | (0.4s)Executing query... \/ (0.5s)Executing query... - (0.6s)Executing query... \\ (0.7s)Executing query... | (0.9s)                                             âš ï¸� Saved failing SQL â\u2020\u2019 output\/failed_testcases\\prod-SIT_pagination_extract.sqlâ�³ Timeout or API error â\u2020\u2019 testcase marked failedâ\u2013¶â\u2013¶â\u2013¶ Running testcase [SIT-prod] for table â\u2020\u2019 pagination_extract â\u2013¶â\u2013¶â\u2013¶â\u2013¶ Generated SQL:SELECT \"pagination_extract\" AS TABLE_NAME,       `PublisherCode`,       `PublicationCode`,       `PublicationName`,       `OptimaLinkToEdition`,       `EditionDate`,       `EditionPageCount`,       `SectionName`,       `SectionCode`,       `SectionPageCount`,       `IDEditionVersion`,       `Description`,       `srcDatabase`FROM `ncau-data-newsquery-sit.sdm_optima.pagination_extract`WHERE dw_partition_date BETWEEN \"2026-02-16\" AND \"2026-02-16\"EXCEPT DISTINCTSELECT \"pagination_extract\" AS TABLE_NAME,       `PublisherCode`,       `PublicationCode`,       `PublicationName`,       `OptimaLinkToEdition`,       `EditionDate`,       `EditionPageCount`,       `SectionName`,       `SectionCode`,       `SectionPageCount`,       `IDEditionVersion`,       `Description`,       `srcDatabase`FROM `ncau-data-newsquery-prd.sdm_optima_dgw.pagination_extract`WHERE dw_partition_date BETWEEN \"2026-02-16\" AND \"2026-02-16\";--------------------------------------------------------------------------------Executing query... | (0.0s)Executing query... \/ (0.2s)Executing query... - (0.3s)Executing query... \\ (0.4s)Executing query... | (0.5s)Executing query... \/ (0.7s)Executing query... - (0.8s)Executing query... \\ (0.9s)Executing query... | (1.0s)                                             âš ï¸� Saved failing SQL â\u2020\u2019 output\/failed_testcases\\SIT-prod_pagination_extract.sqlâ�³ Timeout or API error â\u2020\u2019 testcase marked failedðŸ\u201C� Filtered dataset results saved: output\/testcase_results\\sdm_optima_dgw_except_distinct_deltaload_20260217_141914_filtered_tables_result.csvFinished query: except_distinct_deltaload in 9.41s â\u2020\u2019 output\/testcase_results\\sdm_optima_dgw_except_distinct_deltaload_20260217_141914.csvâœ\u2026 All queries completed successfully \n"}],"executorName":"main","line":3,"name":"Execute run-query.py and check output files","description":"","durationMillis":22150.417996,"startTime":1771318142791,"failed":false,"refId":"[1:3]","endTime":1771318164942,"exampleIndex":-1}],"callDepth":1,"name":"Run run-query.py and verify outputs","description":"","resultDate":"2026-02-17 02:19:24 pm","durationMillis":22150.417996,"passedCount":1}]}],"line":10,"description":"","durationMillis":22469.816214,"failed":false,"tags":["regression"],"executorName":"main","name":"SIT and PROD counts must match","startTime":1771318141974,"refId":"[1:10]","endTime":1771318164949,"exampleIndex":-1}],"callDepth":0,"name":"Validate row data","description":"","resultDate":"2026-02-17 02:19:24 pm","durationMillis":22469.816214,"passedCount":1}