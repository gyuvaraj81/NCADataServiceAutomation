2026-02-17 14:00:52,454 | INFO    | RUN_QUERY | Starting query execution framework...

2026-02-17 14:01:07,879 | INFO    | RUN_QUERY | 
Running query: schema_compare
2026-02-17 14:01:08,086 | INFO    | RUN_QUERY | ‚ñ∂ Generated SQL:
WITH prod_schema AS
  (SELECT TABLE_NAME,
          COLUMN_NAME,
          data_type,
          is_nullable
   FROM `ncau-data-newsquery-prd.sdm_rcti.INFORMATION_SCHEMA.COLUMNS`),
     sit_schema AS
  (SELECT TABLE_NAME,
          COLUMN_NAME,
          data_type,
          is_nullable
   FROM `ncau-data-newsquery-sit.sdm_rcti_nq.INFORMATION_SCHEMA.COLUMNS`),
     all_columns AS
  (-- Get all unique table/column combinations from both datasets
 SELECT TABLE_NAME,
        COLUMN_NAME
   FROM prod_schema
   UNION DISTINCT SELECT TABLE_NAME,
                         COLUMN_NAME
   FROM sit_schema)
SELECT c.table_name,
       c.column_name,
       p.data_type AS prod_type,
       n.data_type AS prod_nq_type,
       p.is_nullable AS prod_nullable,
       n.is_nullable AS prod_nq_nullable,
       CASE
           WHEN p.data_type IS DISTINCT
                FROM n.data_type THEN 'TYPE_MISMATCH'
           WHEN p.is_nullable IS DISTINCT
                FROM n.is_nullable THEN 'NULLABILITY_MISMATCH'
           ELSE 'MATCH'
       END AS diff_status
FROM all_columns c
LEFT JOIN prod_schema p ON c.table_name = p.table_name
AND c.column_name = p.column_name
LEFT JOIN sit_schema n ON c.table_name = n.table_name
AND c.column_name = n.column_name
WHERE c.table_name NOT IN ('cart',
                           'order',
                           'customer',
                           'customer_address')
ORDER BY c.table_name,
         c.column_name;
2026-02-17 14:01:12,173 | INFO    | RUN_QUERY | üìÅ Schema differences saved: output/failed_testcases\sdm_rcti_schema_compare_20260217_140107_schema_diff.csv
2026-02-17 14:01:12,173 | INFO    | RUN_QUERY | Finished query: schema_compare in 4.23s ‚Üí output/testcase_results\sdm_rcti_schema_compare_20260217_140107.csv
2026-02-17 14:01:12,175 | INFO    | RUN_QUERY | All queries completed successfully
2026-02-17 14:01:33,465 | INFO    | RUN_QUERY | Starting query execution framework...

2026-02-17 14:01:42,769 | INFO    | RUN_QUERY | 
Running query: count
2026-02-17 14:01:42,904 | INFO    | RUN_QUERY | ‚ñ∂ Generated SQL:
WITH prod AS
  (SELECT TABLE_NAME,
          PARSE_DATE('%Y%m%d', partition_id) AS partition_date,
          total_rows
   FROM `ncau-data-newsquery-prd.sdm_rcti.INFORMATION_SCHEMA.PARTITIONS`
   WHERE partition_id NOT LIKE '%NULL%'
     AND PARSE_DATE('%Y%m%d', partition_id) BETWEEN DATE('2026-02-16') AND DATE('2026-02-16')),
     prod_nq AS
  (SELECT TABLE_NAME,
          PARSE_DATE('%Y%m%d', partition_id) AS partition_date,
          total_rows
   FROM `ncau-data-newsquery-sit.sdm_rcti_nq.INFORMATION_SCHEMA.PARTITIONS`
   WHERE partition_id NOT LIKE '%NULL%'
     AND PARSE_DATE('%Y%m%d', partition_id) BETWEEN DATE('2026-02-16') AND DATE('2026-02-16')),
     info_table AS
  (SELECT TABLE_NAME
   FROM `ncau-data-newsquery-sit.sdm_rcti_nq.INFORMATION_SCHEMA.TABLES`)
SELECT i.table_name,
       a.partition_date AS sit_prtn_date,
       b.partition_date AS prd_prtn_date,
       a.total_rows AS sit_count,
       b.total_rows AS prd_count,
       a.total_rows - b.total_rows AS diff
FROM info_table i
LEFT JOIN prod_nq a ON i.table_name = a.table_name
LEFT JOIN prod b ON i.table_name = b.table_name
WHERE i.table_name NOT IN ('cart',
                           'order')
ORDER BY 1,
         3;
2026-02-17 14:01:53,346 | WARNING | RUN_QUERY | ‚ùå DIFF FOUND in count query
2026-02-17 14:01:53,347 | INFO    | RUN_QUERY | Finished query: count in 10.57s ‚Üí output/testcase_results\sdm_rcti_count_20260217_140142.csv
2026-02-17 14:01:53,349 | INFO    | RUN_QUERY | All queries completed successfully
2026-02-17 14:03:14,942 | INFO    | RUN_QUERY | Starting query execution framework...

2026-02-17 14:03:35,190 | INFO    | RUN_QUERY | 
Running query: except_distinct_fullload
2026-02-17 14:03:35,622 | INFO    | RUN_QUERY | ‚ñ∂ Generated SQL:
WITH table_info AS
  (SELECT table_catalog,
          table_schema,
          TABLE_NAME,
          STRING_AGG(CONCAT('`', COLUMN_NAME, '`'), ','
                     ORDER BY ordinal_position) AS columns
   FROM `ncau-data-newsquery-prd.sdm_rcti.INFORMATION_SCHEMA.COLUMNS`
   WHERE COLUMN_NAME NOT IN ('nq_batch_id',
                             'dgw_batch_id',
                             'dw_batch_id',
                             'dw_ingest_time',
                             'dw_partition_date',
                             'dw_publish_time',
                             'dw_source_object_name',
                             'soft_error_fields',
                             'extra_data_payload')
     AND TABLE_NAME NOT IN ('appc_send_log',
                            'appc_send_log_0715',
                            'contactsf',
                            'emailobject',
                            'pushmessagedetail',
                            'smsdetailsummary',
                            'cart',
                            'order')
     AND TABLE_NAME NOT IN ('customer',
                            'customer_address',
                            'customer_address_ext',
                            'customer_ext',
                            'demographic',
                            'news_customer_contract',
                            'news_demographic_ex',
                            'news_ext_customer_redemption',
                            'news_financial_transaction',
                            'news_interactions',
                            'news_payment_account_ext',
                            'order_item',
                            'order_item_ext',
                            'order_item_note',
                            'paybreak',
                            'payment',
                            'payment_account',
                            'payment_reversed_payment',
                            'service',
                            'service_ext',
                            'gbaba_act_xref',
                            'ad_custom_fields_export',
                            'customers_export',
                            'display_ads_export',
                            'insert_ads_export',
                            'online_ad_export2',
                            'order_custom_fields_export',
                            'order_export2',
                            'order_item_audience_segment',
                            'order_item_metadata',
                            'order_item_price_item',
                            'order_items')
   GROUP BY table_catalog,
            table_schema,
            TABLE_NAME)
SELECT 'SIT-prod' AS scenario,
       TABLE_NAME,
       CONCAT('SELECT "', TABLE_NAME, '" AS table_name, ', columns, ' FROM `', 'ncau-data-newsquery-sit', '.', 'sdm_rcti_nq', '.', TABLE_NAME, '` ', 'WHERE dw_partition_date BETWEEN "', '2026-02-16', '" AND "', '2026-02-16', '" ', ' EXCEPT DISTINCT ', 'SELECT "', TABLE_NAME, '" AS table_name, ', columns, ' FROM `', 'ncau-data-newsquery-prd', '.', 'sdm_rcti', '.', TABLE_NAME, '` ', 'WHERE dw_partition_date BETWEEN "', '2026-02-16', '" AND "', '2026-02-16', '";') AS testcase
FROM table_info
UNION ALL
SELECT 'prod-SIT' AS scenario,
       TABLE_NAME,
       CONCAT('SELECT "', TABLE_NAME, '" AS table_name, ', columns, ' FROM `', 'ncau-data-newsquery-prd', '.', 'sdm_rcti', '.', TABLE_NAME, '` ', 'WHERE dw_partition_date BETWEEN "', '2026-02-16', '" AND "', '2026-02-16', '" ', ' EXCEPT DISTINCT ', 'SELECT "', TABLE_NAME, '" AS table_name, ', columns, ' FROM `', 'ncau-data-newsquery-sit', '.', 'sdm_rcti_nq', '.', TABLE_NAME, '` ', 'WHERE dw_partition_date BETWEEN "', '2026-02-16', '" AND "', '2026-02-16', '";') AS testcase
FROM table_info
ORDER BY TABLE_NAME;
2026-02-17 14:03:39,419 | INFO    | RUN_QUERY | ‚úÖ Running testcases for tables starting with ''
2026-02-17 14:03:39,420 | INFO    | RUN_QUERY | Executing EXCEPT DISTINCT testcases...

2026-02-17 14:04:09,470 | INFO    | RUN_QUERY | ‚ùå Testcase failed ‚Üí 93164 differing row(s) found
2026-02-17 14:04:11,490 | INFO    | RUN_QUERY | ‚úî Testcase passed ‚Üí no differences found
2026-02-17 14:04:12,329 | WARNING | RUN_QUERY | ‚è≥ Timeout or API error: 404 Not found: Table ncau-data-newsquery-sit:sdm_rcti_nq.payonscan_bluebook_ext_backup_11022026 was not found in location US; reason: notFound, message: Not found: Table ncau-data-newsquery-sit:sdm_rcti_nq.payonscan_bluebook_ext_backup_11022026 was not found in location US

Location: US
Job ID: 7e7247b7-4a60-4e4e-9c12-57d6b9432e15

2026-02-17 14:04:13,061 | WARNING | RUN_QUERY | ‚è≥ Timeout or API error: 404 Not found: Table ncau-data-newsquery-sit:sdm_rcti_nq.payonscan_bluebook_ext_backup_11022026 was not found in location US; reason: notFound, message: Not found: Table ncau-data-newsquery-sit:sdm_rcti_nq.payonscan_bluebook_ext_backup_11022026 was not found in location US

Location: US
Job ID: fd4629b9-cf0c-419a-8e2a-43e1fa696251

2026-02-17 14:04:13,693 | WARNING | RUN_QUERY | ‚è≥ Timeout or API error: 404 Not found: Table ncau-data-newsquery-sit:sdm_rcti_nq.payonscan_bluebook_ext_db_to_bq was not found in location US; reason: notFound, message: Not found: Table ncau-data-newsquery-sit:sdm_rcti_nq.payonscan_bluebook_ext_db_to_bq was not found in location US

Location: US
Job ID: d139f6b9-f706-405e-a6bb-b12a43b93395

2026-02-17 14:04:14,348 | WARNING | RUN_QUERY | ‚è≥ Timeout or API error: 404 Not found: Table ncau-data-newsquery-sit:sdm_rcti_nq.payonscan_bluebook_ext_db_to_bq was not found in location US; reason: notFound, message: Not found: Table ncau-data-newsquery-sit:sdm_rcti_nq.payonscan_bluebook_ext_db_to_bq was not found in location US

Location: US
Job ID: bd84b102-474d-4b62-a394-2d0f7952b9bb

2026-02-17 14:04:20,382 | INFO    | RUN_QUERY | ‚ùå Testcase failed ‚Üí 9772 differing row(s) found
2026-02-17 14:04:22,631 | INFO    | RUN_QUERY | ‚úî Testcase passed ‚Üí no differences found
2026-02-17 14:04:23,260 | WARNING | RUN_QUERY | ‚è≥ Timeout or API error: 404 Not found: Table ncau-data-newsquery-sit:sdm_rcti_nq.rcti_7eleven_bluebook_ext_backup_11022026 was not found in location US; reason: notFound, message: Not found: Table ncau-data-newsquery-sit:sdm_rcti_nq.rcti_7eleven_bluebook_ext_backup_11022026 was not found in location US

Location: US
Job ID: 899d69d5-2281-4231-9325-bfe3d5e19796

2026-02-17 14:04:24,029 | WARNING | RUN_QUERY | ‚è≥ Timeout or API error: 404 Not found: Table ncau-data-newsquery-sit:sdm_rcti_nq.rcti_7eleven_bluebook_ext_backup_11022026 was not found in location US; reason: notFound, message: Not found: Table ncau-data-newsquery-sit:sdm_rcti_nq.rcti_7eleven_bluebook_ext_backup_11022026 was not found in location US

Location: US
Job ID: e10ff807-7f64-490c-bb38-e85c8dc8937c

2026-02-17 14:04:25,514 | INFO    | RUN_QUERY | ‚úî Testcase passed ‚Üí no differences found
2026-02-17 14:04:27,392 | INFO    | RUN_QUERY | ‚úî Testcase passed ‚Üí no differences found
2026-02-17 14:04:28,020 | WARNING | RUN_QUERY | ‚è≥ Timeout or API error: 404 Not found: Table ncau-data-newsquery-sit:sdm_rcti_nq.rcti_caltex_bluebook_ext_backup_11022026 was not found in location US; reason: notFound, message: Not found: Table ncau-data-newsquery-sit:sdm_rcti_nq.rcti_caltex_bluebook_ext_backup_11022026 was not found in location US

Location: US
Job ID: 0345d9e8-e2e8-49e8-af46-10368da4ac71

2026-02-17 14:04:28,544 | WARNING | RUN_QUERY | ‚è≥ Timeout or API error: 404 Not found: Table ncau-data-newsquery-sit:sdm_rcti_nq.rcti_caltex_bluebook_ext_backup_11022026 was not found in location US; reason: notFound, message: Not found: Table ncau-data-newsquery-sit:sdm_rcti_nq.rcti_caltex_bluebook_ext_backup_11022026 was not found in location US

Location: US
Job ID: d960984e-de31-42dd-9379-ab4ee3beeb6a

2026-02-17 14:04:30,983 | INFO    | RUN_QUERY | ‚ùå Testcase failed ‚Üí 1484 differing row(s) found
2026-02-17 14:04:32,860 | INFO    | RUN_QUERY | ‚úî Testcase passed ‚Üí no differences found
2026-02-17 14:04:39,555 | INFO    | RUN_QUERY | ‚ùå Testcase failed ‚Üí 9167 differing row(s) found
2026-02-17 14:04:41,679 | INFO    | RUN_QUERY | ‚úî Testcase passed ‚Üí no differences found
2026-02-17 14:04:42,229 | WARNING | RUN_QUERY | ‚è≥ Timeout or API error: 404 Not found: Table ncau-data-newsquery-sit:sdm_rcti_nq.rcti_coles_bluebook_ext_backup_11022026 was not found in location US; reason: notFound, message: Not found: Table ncau-data-newsquery-sit:sdm_rcti_nq.rcti_coles_bluebook_ext_backup_11022026 was not found in location US

Location: US
Job ID: 085cd77e-bd5e-4d44-b4bd-cd72bb80253c

2026-02-17 14:04:42,958 | WARNING | RUN_QUERY | ‚è≥ Timeout or API error: 404 Not found: Table ncau-data-newsquery-sit:sdm_rcti_nq.rcti_coles_bluebook_ext_backup_11022026 was not found in location US; reason: notFound, message: Not found: Table ncau-data-newsquery-sit:sdm_rcti_nq.rcti_coles_bluebook_ext_backup_11022026 was not found in location US

Location: US
Job ID: 0e7080af-0d4e-4aad-9d4d-2f4be41fe179

2026-02-17 14:04:49,865 | INFO    | RUN_QUERY | ‚ùå Testcase failed ‚Üí 11486 differing row(s) found
2026-02-17 14:04:51,455 | INFO    | RUN_QUERY | ‚úî Testcase passed ‚Üí no differences found
2026-02-17 14:04:52,304 | WARNING | RUN_QUERY | ‚è≥ Timeout or API error: 404 Not found: Table ncau-data-newsquery-sit:sdm_rcti_nq.rcti_coles_sm_bluebook_ext_backup_11022026 was not found in location US; reason: notFound, message: Not found: Table ncau-data-newsquery-sit:sdm_rcti_nq.rcti_coles_sm_bluebook_ext_backup_11022026 was not found in location US

Location: US
Job ID: 4d721286-2e4a-40d0-82c4-d8e390d6b1af

2026-02-17 14:04:52,941 | WARNING | RUN_QUERY | ‚è≥ Timeout or API error: 404 Not found: Table ncau-data-newsquery-sit:sdm_rcti_nq.rcti_coles_sm_bluebook_ext_backup_11022026 was not found in location US; reason: notFound, message: Not found: Table ncau-data-newsquery-sit:sdm_rcti_nq.rcti_coles_sm_bluebook_ext_backup_11022026 was not found in location US

Location: US
Job ID: e43c7b03-6363-4404-a0c0-fa160723316c

2026-02-17 14:04:54,243 | WARNING | RUN_QUERY | ‚è≥ Timeout or API error: 400 Unrecognized name: dw_sdm_ingest_date at [1:576]; reason: invalidQuery, location: query, message: Unrecognized name: dw_sdm_ingest_date at [1:576]

Location: US
Job ID: eb8fb064-f7ef-4633-9ec2-4bde588e2973

2026-02-17 14:04:55,132 | WARNING | RUN_QUERY | ‚è≥ Timeout or API error: 400 Unrecognized name: dw_sdm_ingest_date at [1:187]; reason: invalidQuery, location: query, message: Unrecognized name: dw_sdm_ingest_date at [1:187]

Location: US
Job ID: 192690a0-a3ef-4eb2-94d7-cc016030f051

2026-02-17 14:05:02,950 | INFO    | RUN_QUERY | ‚ùå Testcase failed ‚Üí 15010 differing row(s) found
2026-02-17 14:05:05,180 | INFO    | RUN_QUERY | ‚úî Testcase passed ‚Üí no differences found
2026-02-17 14:05:05,944 | WARNING | RUN_QUERY | ‚è≥ Timeout or API error: 404 Not found: Table ncau-data-newsquery-sit:sdm_rcti_nq.rcti_woolies_bluebook_ext_backup_11022026 was not found in location US; reason: notFound, message: Not found: Table ncau-data-newsquery-sit:sdm_rcti_nq.rcti_woolies_bluebook_ext_backup_11022026 was not found in location US

Location: US
Job ID: abadb694-3d68-421c-bf6a-c2135d64898e

2026-02-17 14:05:06,783 | WARNING | RUN_QUERY | ‚è≥ Timeout or API error: 404 Not found: Table ncau-data-newsquery-sit:sdm_rcti_nq.rcti_woolies_bluebook_ext_backup_11022026 was not found in location US; reason: notFound, message: Not found: Table ncau-data-newsquery-sit:sdm_rcti_nq.rcti_woolies_bluebook_ext_backup_11022026 was not found in location US

Location: US
Job ID: e2f7300b-a25e-459e-8d37-835f51ca57d7

2026-02-17 14:05:12,540 | INFO    | RUN_QUERY | ‚ùå Testcase failed ‚Üí 12339 differing row(s) found
2026-02-17 14:05:14,727 | INFO    | RUN_QUERY | ‚úî Testcase passed ‚Üí no differences found
2026-02-17 14:05:15,826 | WARNING | RUN_QUERY | ‚è≥ Timeout or API error: 400 Unrecognized name: dw_sdm_ingest_date at [1:546]; reason: invalidQuery, location: query, message: Unrecognized name: dw_sdm_ingest_date at [1:546]

Location: US
Job ID: 60b27dbf-0712-47aa-9a87-cabc9305aa01

2026-02-17 14:05:16,706 | WARNING | RUN_QUERY | ‚è≥ Timeout or API error: 400 Unrecognized name: dw_sdm_ingest_date at [1:170]; reason: invalidQuery, location: query, message: Unrecognized name: dw_sdm_ingest_date at [1:170]

Location: US
Job ID: 6ba37ab3-f76d-4723-bb4c-33d0f5c57f30

2026-02-17 14:05:16,724 | INFO    | RUN_QUERY | 
üìÅ Filtered dataset results saved: output/testcase_results\sdm_rcti_except_distinct_fullload_20260217_140335_filtered_tables_result.csv
2026-02-17 14:05:16,726 | INFO    | RUN_QUERY | Finished query: except_distinct_fullload in 101.30s ‚Üí output/testcase_results\sdm_rcti_except_distinct_fullload_20260217_140335.csv
2026-02-17 14:05:16,726 | INFO    | RUN_QUERY | All queries completed successfully
2026-02-17 14:06:07,502 | INFO    | RUN_QUERY | Starting query execution framework...

2026-02-17 14:06:20,610 | INFO    | RUN_QUERY | 
Running query: schema_compare
2026-02-17 14:06:20,741 | INFO    | RUN_QUERY | ‚ñ∂ Generated SQL:
WITH prod_schema AS
  (SELECT TABLE_NAME,
          COLUMN_NAME,
          data_type,
          is_nullable
   FROM `ncau-data-newsquery-prd.sdm_optima_dgw.INFORMATION_SCHEMA.COLUMNS`),
     sit_schema AS
  (SELECT TABLE_NAME,
          COLUMN_NAME,
          data_type,
          is_nullable
   FROM `ncau-data-newsquery-sit.sdm_optima.INFORMATION_SCHEMA.COLUMNS`),
     all_columns AS
  (-- Get all unique table/column combinations from both datasets
 SELECT TABLE_NAME,
        COLUMN_NAME
   FROM prod_schema
   UNION DISTINCT SELECT TABLE_NAME,
                         COLUMN_NAME
   FROM sit_schema)
SELECT c.table_name,
       c.column_name,
       p.data_type AS prod_type,
       n.data_type AS prod_nq_type,
       p.is_nullable AS prod_nullable,
       n.is_nullable AS prod_nq_nullable,
       CASE
           WHEN p.data_type IS DISTINCT
                FROM n.data_type THEN 'TYPE_MISMATCH'
           WHEN p.is_nullable IS DISTINCT
                FROM n.is_nullable THEN 'NULLABILITY_MISMATCH'
           ELSE 'MATCH'
       END AS diff_status
FROM all_columns c
LEFT JOIN prod_schema p ON c.table_name = p.table_name
AND c.column_name = p.column_name
LEFT JOIN sit_schema n ON c.table_name = n.table_name
AND c.column_name = n.column_name
WHERE c.table_name NOT IN ('cart',
                           'order',
                           'customer',
                           'customer_address')
ORDER BY c.table_name,
         c.column_name;
2026-02-17 14:06:25,221 | INFO    | RUN_QUERY | üìÅ Schema differences saved: output/failed_testcases\sdm_optima_dgw_schema_compare_20260217_140620_schema_diff.csv
2026-02-17 14:06:25,221 | INFO    | RUN_QUERY | Finished query: schema_compare in 4.61s ‚Üí output/testcase_results\sdm_optima_dgw_schema_compare_20260217_140620.csv
2026-02-17 14:06:25,223 | INFO    | RUN_QUERY | All queries completed successfully
2026-02-17 14:06:45,417 | INFO    | RUN_QUERY | Starting query execution framework...

2026-02-17 14:06:58,782 | INFO    | RUN_QUERY | 
Running query: count
2026-02-17 14:06:58,897 | INFO    | RUN_QUERY | ‚ñ∂ Generated SQL:
WITH prod AS
  (SELECT TABLE_NAME,
          PARSE_DATE('%Y%m%d', partition_id) AS partition_date,
          total_rows
   FROM `ncau-data-newsquery-prd.sdm_optima_dgw.INFORMATION_SCHEMA.PARTITIONS`
   WHERE partition_id NOT LIKE '%NULL%'
     AND PARSE_DATE('%Y%m%d', partition_id) BETWEEN DATE('2026-02-16') AND DATE('2026-02-16')),
     prod_nq AS
  (SELECT TABLE_NAME,
          PARSE_DATE('%Y%m%d', partition_id) AS partition_date,
          total_rows
   FROM `ncau-data-newsquery-sit.sdm_optima.INFORMATION_SCHEMA.PARTITIONS`
   WHERE partition_id NOT LIKE '%NULL%'
     AND PARSE_DATE('%Y%m%d', partition_id) BETWEEN DATE('2026-02-16') AND DATE('2026-02-16')),
     info_table AS
  (SELECT TABLE_NAME
   FROM `ncau-data-newsquery-sit.sdm_optima.INFORMATION_SCHEMA.TABLES`)
SELECT i.table_name,
       a.partition_date AS sit_prtn_date,
       b.partition_date AS prd_prtn_date,
       a.total_rows AS sit_count,
       b.total_rows AS prd_count,
       a.total_rows - b.total_rows AS diff
FROM info_table i
LEFT JOIN prod_nq a ON i.table_name = a.table_name
LEFT JOIN prod b ON i.table_name = b.table_name
WHERE i.table_name NOT IN ('cart',
                           'order')
ORDER BY 1,
         3;
2026-02-17 14:07:04,461 | WARNING | RUN_QUERY | ‚ùå DIFF FOUND in count query
2026-02-17 14:07:04,462 | INFO    | RUN_QUERY | Finished query: count in 5.67s ‚Üí output/testcase_results\sdm_optima_dgw_count_20260217_140658.csv
2026-02-17 14:07:04,465 | INFO    | RUN_QUERY | All queries completed successfully
2026-02-17 14:07:34,940 | INFO    | RUN_QUERY | Starting query execution framework...

2026-02-17 14:07:51,724 | INFO    | RUN_QUERY | 
Running query: except_distinct_fullload
2026-02-17 14:07:51,883 | INFO    | RUN_QUERY | ‚ñ∂ Generated SQL:
WITH table_info AS
  (SELECT table_catalog,
          table_schema,
          TABLE_NAME,
          STRING_AGG(CONCAT('`', COLUMN_NAME, '`'), ','
                     ORDER BY ordinal_position) AS columns
   FROM `ncau-data-newsquery-prd.sdm_optima_dgw.INFORMATION_SCHEMA.COLUMNS`
   WHERE COLUMN_NAME NOT IN ('nq_batch_id',
                             'dgw_batch_id',
                             'dw_batch_id',
                             'dw_ingest_time',
                             'dw_partition_date',
                             'dw_publish_time',
                             'dw_source_object_name',
                             'soft_error_fields',
                             'extra_data_payload')
     AND TABLE_NAME NOT IN ('appc_send_log',
                            'appc_send_log_0715',
                            'contactsf',
                            'emailobject',
                            'pushmessagedetail',
                            'smsdetailsummary',
                            'cart',
                            'order')
     AND TABLE_NAME NOT IN ('customer',
                            'customer_address',
                            'customer_address_ext',
                            'customer_ext',
                            'demographic',
                            'news_customer_contract',
                            'news_demographic_ex',
                            'news_ext_customer_redemption',
                            'news_financial_transaction',
                            'news_interactions',
                            'news_payment_account_ext',
                            'order_item',
                            'order_item_ext',
                            'order_item_note',
                            'paybreak',
                            'payment',
                            'payment_account',
                            'payment_reversed_payment',
                            'service',
                            'service_ext',
                            'gbaba_act_xref',
                            'ad_custom_fields_export',
                            'customers_export',
                            'display_ads_export',
                            'insert_ads_export',
                            'online_ad_export2',
                            'order_custom_fields_export',
                            'order_export2',
                            'order_item_audience_segment',
                            'order_item_metadata',
                            'order_item_price_item',
                            'order_items')
   GROUP BY table_catalog,
            table_schema,
            TABLE_NAME)
SELECT 'SIT-prod' AS scenario,
       TABLE_NAME,
       CONCAT('SELECT "', TABLE_NAME, '" AS table_name, ', columns, ' FROM `', 'ncau-data-newsquery-sit', '.', 'sdm_optima', '.', TABLE_NAME, '` ', 'WHERE dw_partition_date BETWEEN "', '2026-02-16', '" AND "', '2026-02-16', '" ', ' EXCEPT DISTINCT ', 'SELECT "', TABLE_NAME, '" AS table_name, ', columns, ' FROM `', 'ncau-data-newsquery-prd', '.', 'sdm_optima_dgw', '.', TABLE_NAME, '` ', 'WHERE dw_partition_date BETWEEN "', '2026-02-16', '" AND "', '2026-02-16', '";') AS testcase
FROM table_info
UNION ALL
SELECT 'prod-SIT' AS scenario,
       TABLE_NAME,
       CONCAT('SELECT "', TABLE_NAME, '" AS table_name, ', columns, ' FROM `', 'ncau-data-newsquery-prd', '.', 'sdm_optima_dgw', '.', TABLE_NAME, '` ', 'WHERE dw_partition_date BETWEEN "', '2026-02-16', '" AND "', '2026-02-16', '" ', ' EXCEPT DISTINCT ', 'SELECT "', TABLE_NAME, '" AS table_name, ', columns, ' FROM `', 'ncau-data-newsquery-sit', '.', 'sdm_optima', '.', TABLE_NAME, '` ', 'WHERE dw_partition_date BETWEEN "', '2026-02-16', '" AND "', '2026-02-16', '";') AS testcase
FROM table_info
ORDER BY TABLE_NAME;
2026-02-17 14:07:55,254 | INFO    | RUN_QUERY | ‚úÖ Running testcases for tables starting with ''
2026-02-17 14:07:55,255 | INFO    | RUN_QUERY | Executing EXCEPT DISTINCT testcases...

2026-02-17 14:07:57,329 | INFO    | RUN_QUERY | ‚úî Testcase passed ‚Üí no differences found
2026-02-17 14:07:59,636 | INFO    | RUN_QUERY | ‚ùå Testcase failed ‚Üí 1677 differing row(s) found
2026-02-17 14:08:00,747 | WARNING | RUN_QUERY | ‚è≥ Timeout or API error: 400 Column 6 in EXCEPT DISTINCT has incompatible types: INT64, DATE at [1:385]; reason: invalidQuery, location: query, message: Column 6 in EXCEPT DISTINCT has incompatible types: INT64, DATE at [1:385]

Location: US
Job ID: 2a792cba-29ee-473f-a5c8-984f91b39517

2026-02-17 14:08:01,887 | WARNING | RUN_QUERY | ‚è≥ Timeout or API error: 400 Column 6 in EXCEPT DISTINCT has incompatible types: DATE, INT64 at [1:389]; reason: invalidQuery, location: query, message: Column 6 in EXCEPT DISTINCT has incompatible types: DATE, INT64 at [1:389]

Location: US
Job ID: a01db0a9-1d4d-4d82-ba31-05f184c16723

2026-02-17 14:08:01,913 | INFO    | RUN_QUERY | 
üìÅ Filtered dataset results saved: output/testcase_results\sdm_optima_dgw_except_distinct_fullload_20260217_140751_filtered_tables_result.csv
2026-02-17 14:08:01,914 | INFO    | RUN_QUERY | Finished query: except_distinct_fullload in 10.18s ‚Üí output/testcase_results\sdm_optima_dgw_except_distinct_fullload_20260217_140751.csv
2026-02-17 14:08:01,914 | INFO    | RUN_QUERY | All queries completed successfully
2026-02-17 14:08:45,027 | INFO    | RUN_QUERY | Starting query execution framework...

2026-02-17 14:08:58,492 | INFO    | RUN_QUERY | 
Running query: schema_compare
2026-02-17 14:08:58,633 | INFO    | RUN_QUERY | ‚ñ∂ Generated SQL:
WITH prod_schema AS
  (SELECT TABLE_NAME,
          COLUMN_NAME,
          data_type,
          is_nullable
   FROM `ncau-data-newsquery-prd.sdm_advertisingexternals_dgw.INFORMATION_SCHEMA.COLUMNS`),
     sit_schema AS
  (SELECT TABLE_NAME,
          COLUMN_NAME,
          data_type,
          is_nullable
   FROM `ncau-data-newsquery-sit.sdm_advertisingexternals.INFORMATION_SCHEMA.COLUMNS`),
     all_columns AS
  (-- Get all unique table/column combinations from both datasets
 SELECT TABLE_NAME,
        COLUMN_NAME
   FROM prod_schema
   UNION DISTINCT SELECT TABLE_NAME,
                         COLUMN_NAME
   FROM sit_schema)
SELECT c.table_name,
       c.column_name,
       p.data_type AS prod_type,
       n.data_type AS prod_nq_type,
       p.is_nullable AS prod_nullable,
       n.is_nullable AS prod_nq_nullable,
       CASE
           WHEN p.data_type IS DISTINCT
                FROM n.data_type THEN 'TYPE_MISMATCH'
           WHEN p.is_nullable IS DISTINCT
                FROM n.is_nullable THEN 'NULLABILITY_MISMATCH'
           ELSE 'MATCH'
       END AS diff_status
FROM all_columns c
LEFT JOIN prod_schema p ON c.table_name = p.table_name
AND c.column_name = p.column_name
LEFT JOIN sit_schema n ON c.table_name = n.table_name
AND c.column_name = n.column_name
WHERE c.table_name NOT IN ('cart',
                           'order',
                           'customer',
                           'customer_address')
ORDER BY c.table_name,
         c.column_name;
2026-02-17 14:09:02,895 | INFO    | RUN_QUERY | üìÅ Schema differences saved: output/failed_testcases\sdm_advertisingexternals_dgw_schema_compare_20260217_140858_schema_diff.csv
2026-02-17 14:09:02,896 | INFO    | RUN_QUERY | Finished query: schema_compare in 4.40s ‚Üí output/testcase_results\sdm_advertisingexternals_dgw_schema_compare_20260217_140858.csv
2026-02-17 14:09:02,898 | INFO    | RUN_QUERY | All queries completed successfully
2026-02-17 14:09:26,122 | INFO    | RUN_QUERY | Starting query execution framework...

2026-02-17 14:09:37,308 | INFO    | RUN_QUERY | 
Running query: count
2026-02-17 14:09:37,445 | INFO    | RUN_QUERY | ‚ñ∂ Generated SQL:
WITH prod AS
  (SELECT TABLE_NAME,
          PARSE_DATE('%Y%m%d', partition_id) AS partition_date,
          total_rows
   FROM `ncau-data-newsquery-prd.sdm_advertisingexternals_dgw.INFORMATION_SCHEMA.PARTITIONS`
   WHERE partition_id NOT LIKE '%NULL%'
     AND PARSE_DATE('%Y%m%d', partition_id) BETWEEN DATE('2026-02-16') AND DATE('2026-02-16')),
     prod_nq AS
  (SELECT TABLE_NAME,
          PARSE_DATE('%Y%m%d', partition_id) AS partition_date,
          total_rows
   FROM `ncau-data-newsquery-sit.sdm_advertisingexternals.INFORMATION_SCHEMA.PARTITIONS`
   WHERE partition_id NOT LIKE '%NULL%'
     AND PARSE_DATE('%Y%m%d', partition_id) BETWEEN DATE('2026-02-16') AND DATE('2026-02-16')),
     info_table AS
  (SELECT TABLE_NAME
   FROM `ncau-data-newsquery-sit.sdm_advertisingexternals.INFORMATION_SCHEMA.TABLES`)
SELECT i.table_name,
       a.partition_date AS sit_prtn_date,
       b.partition_date AS prd_prtn_date,
       a.total_rows AS sit_count,
       b.total_rows AS prd_count,
       a.total_rows - b.total_rows AS diff
FROM info_table i
LEFT JOIN prod_nq a ON i.table_name = a.table_name
LEFT JOIN prod b ON i.table_name = b.table_name
WHERE i.table_name NOT IN ('cart',
                           'order')
ORDER BY 1,
         3;
2026-02-17 14:09:56,596 | WARNING | RUN_QUERY | ‚ùå DIFF FOUND in count query
2026-02-17 14:09:56,596 | INFO    | RUN_QUERY | Finished query: count in 19.28s ‚Üí output/testcase_results\sdm_advertisingexternals_dgw_count_20260217_140937.csv
2026-02-17 14:09:56,598 | INFO    | RUN_QUERY | All queries completed successfully
2026-02-17 14:10:34,832 | INFO    | RUN_QUERY | Starting query execution framework...

2026-02-17 14:10:45,803 | INFO    | RUN_QUERY | 
Running query: except_distinct_deltaload
2026-02-17 14:10:46,322 | INFO    | RUN_QUERY | ‚ñ∂ Generated SQL:
WITH table_info AS
  (SELECT table_catalog,
          table_schema,
          TABLE_NAME,
          STRING_AGG(CONCAT('`', COLUMN_NAME, '`'), ','
                     ORDER BY ordinal_position) AS columns
   FROM `ncau-data-newsquery-prd.sdm_advertisingexternals_dgw.INFORMATION_SCHEMA.COLUMNS`
   WHERE COLUMN_NAME NOT IN ('nq_batch_id',
                             'dgw_batch_id',
                             'dw_batch_id',
                             'dw_ingest_time',
                             'dw_partition_date',
                             'dw_publish_time',
                             'dw_source_object_name',
                             'soft_error_fields',
                             'extra_data_payload')
     AND TABLE_NAME NOT IN ('appc_send_log',
                            'appc_send_log_0715',
                            'contactsf',
                            'emailobject',
                            'pushmessagedetail',
                            'smsdetailsummary',
                            'cart',
                            'order')
     AND TABLE_NAME IN ('customer',
                        'customer_address',
                        'customer_address_ext',
                        'customer_ext',
                        'demographic',
                        'news_customer_contract',
                        'news_demographic_ex',
                        'news_ext_customer_redemption',
                        'news_financial_transaction',
                        'news_interactions',
                        'news_payment_account_ext',
                        'order_item',
                        'order_item_ext',
                        'order_item_note',
                        'paybreak',
                        'payment',
                        'payment_account',
                        'payment_reversed_payment',
                        'service',
                        'service_ext',
                        'gbaba_act_xref',
                        'ad_custom_fields_export',
                        'customers_export',
                        'display_ads_export',
                        'insert_ads_export',
                        'online_ad_export2',
                        'order_custom_fields_export',
                        'order_export2',
                        'order_item_audience_segment',
                        'order_item_metadata',
                        'order_item_price_item',
                        'order_items')
   GROUP BY table_catalog,
            table_schema,
            TABLE_NAME)
SELECT 'SIT-prod' AS scenario,
       TABLE_NAME,
       CONCAT('SELECT "', TABLE_NAME, '" AS table_name, ', columns, ' FROM `', 'ncau-data-newsquery-sit', '.', 'sdm_advertisingexternals', '.', TABLE_NAME, '` ', 'WHERE dw_partition_date BETWEEN "', '2026-02-16', '" AND "', '2026-02-16', '" ', ' EXCEPT DISTINCT ', 'SELECT "', TABLE_NAME, '" AS table_name, ', columns, ' FROM `', 'ncau-data-newsquery-prd', '.', 'sdm_advertisingexternals_dgw', '.', TABLE_NAME, '` ', 'WHERE dw_partition_date BETWEEN "', '2026-02-16', '" AND "', '2026-02-16', '";') AS testcase
FROM table_info
UNION ALL
SELECT 'prod-SIT' AS scenario,
       TABLE_NAME,
       CONCAT('SELECT "', TABLE_NAME, '" AS table_name, ', columns, ' FROM `', 'ncau-data-newsquery-prd', '.', 'sdm_advertisingexternals_dgw', '.', TABLE_NAME, '` ', 'WHERE dw_partition_date BETWEEN "', '2026-02-16', '" AND "', '2026-02-16', '" ', ' EXCEPT DISTINCT ', 'SELECT "', TABLE_NAME, '" AS table_name, ', columns, ' FROM `', 'ncau-data-newsquery-sit', '.', 'sdm_advertisingexternals', '.', TABLE_NAME, '` ', 'WHERE dw_partition_date BETWEEN "', '2026-02-16', '" AND "', '2026-02-16', '";') AS testcase
FROM table_info
ORDER BY TABLE_NAME;
2026-02-17 14:10:50,234 | INFO    | RUN_QUERY | ‚úÖ Running testcases for tables starting with ''
2026-02-17 14:10:50,235 | INFO    | RUN_QUERY | Executing EXCEPT DISTINCT testcases...

2026-02-17 14:10:52,542 | INFO    | RUN_QUERY | ‚úî Testcase passed ‚Üí no differences found
2026-02-17 14:10:54,650 | INFO    | RUN_QUERY | ‚ùå Testcase failed ‚Üí 14 differing row(s) found
2026-02-17 14:10:54,662 | INFO    | RUN_QUERY | 
üìÅ Filtered dataset results saved: output/testcase_results\sdm_advertisingexternals_dgw_except_distinct_deltaload_20260217_141046_filtered_tables_result.csv
2026-02-17 14:10:54,662 | INFO    | RUN_QUERY | Finished query: except_distinct_deltaload in 8.63s ‚Üí output/testcase_results\sdm_advertisingexternals_dgw_except_distinct_deltaload_20260217_141046.csv
2026-02-17 14:10:54,663 | INFO    | RUN_QUERY | All queries completed successfully
2026-02-17 14:15:59,393 | INFO    | RUN_QUERY | Starting query execution framework...

2026-02-17 14:16:10,256 | INFO    | RUN_QUERY | 
Running query: count
2026-02-17 14:16:10,356 | INFO    | RUN_QUERY | ‚ñ∂ Generated SQL:
WITH prod AS
  (SELECT TABLE_NAME,
          PARSE_DATE('%Y%m%d', partition_id) AS partition_date,
          total_rows
   FROM `ncau-data-newsquery-prd.sdm_rcti.INFORMATION_SCHEMA.PARTITIONS`
   WHERE partition_id NOT LIKE '%NULL%'
     AND PARSE_DATE('%Y%m%d', partition_id) BETWEEN DATE('2026-02-16') AND DATE('2026-02-16')),
     prod_nq AS
  (SELECT TABLE_NAME,
          PARSE_DATE('%Y%m%d', partition_id) AS partition_date,
          total_rows
   FROM `ncau-data-newsquery-sit.sdm_rcti_nq.INFORMATION_SCHEMA.PARTITIONS`
   WHERE partition_id NOT LIKE '%NULL%'
     AND PARSE_DATE('%Y%m%d', partition_id) BETWEEN DATE('2026-02-16') AND DATE('2026-02-16')),
     info_table AS
  (SELECT TABLE_NAME
   FROM `ncau-data-newsquery-sit.sdm_rcti_nq.INFORMATION_SCHEMA.TABLES`)
SELECT i.table_name,
       a.partition_date AS sit_prtn_date,
       b.partition_date AS prd_prtn_date,
       a.total_rows AS sit_count,
       b.total_rows AS prd_count,
       a.total_rows - b.total_rows AS diff
FROM info_table i
LEFT JOIN prod_nq a ON i.table_name = a.table_name
LEFT JOIN prod b ON i.table_name = b.table_name
WHERE i.table_name NOT IN ('cart',
                           'order')
ORDER BY 1,
         3;
2026-02-17 14:16:21,197 | WARNING | RUN_QUERY | ‚ùå DIFF FOUND in count query
2026-02-17 14:16:21,197 | INFO    | RUN_QUERY | Finished query: count in 10.94s ‚Üí output/testcase_results\sdm_rcti_count_20260217_141610.csv
2026-02-17 14:16:21,199 | INFO    | RUN_QUERY | All queries completed successfully
2026-02-17 14:16:45,523 | INFO    | RUN_QUERY | Starting query execution framework...

2026-02-17 14:16:54,706 | INFO    | RUN_QUERY | 
Running query: except_distinct_deltaload
2026-02-17 14:16:54,864 | INFO    | RUN_QUERY | ‚ñ∂ Generated SQL:
WITH table_info AS
  (SELECT table_catalog,
          table_schema,
          TABLE_NAME,
          STRING_AGG(CONCAT('`', COLUMN_NAME, '`'), ','
                     ORDER BY ordinal_position) AS columns
   FROM `ncau-data-newsquery-prd.sdm_rcti.INFORMATION_SCHEMA.COLUMNS`
   WHERE COLUMN_NAME NOT IN ('nq_batch_id',
                             'dgw_batch_id',
                             'dw_batch_id',
                             'dw_ingest_time',
                             'dw_partition_date',
                             'dw_publish_time',
                             'dw_source_object_name',
                             'soft_error_fields',
                             'extra_data_payload')
     AND TABLE_NAME NOT IN ('appc_send_log',
                            'appc_send_log_0715',
                            'contactsf',
                            'emailobject',
                            'pushmessagedetail',
                            'smsdetailsummary',
                            'cart',
                            'order')
     AND TABLE_NAME IN ('customer',
                        'customer_address',
                        'customer_address_ext',
                        'customer_ext',
                        'demographic',
                        'news_customer_contract',
                        'news_demographic_ex',
                        'news_ext_customer_redemption',
                        'news_financial_transaction',
                        'news_interactions',
                        'news_payment_account_ext',
                        'order_item',
                        'order_item_ext',
                        'order_item_note',
                        'paybreak',
                        'payment',
                        'payment_account',
                        'payment_reversed_payment',
                        'service',
                        'service_ext',
                        'gbaba_act_xref',
                        'audit_extract',
                        'pagination_extract',
                        'payonscan_bluebook_ext',
                        'rcti_7eleven_bluebook_ext',
                        'rcti_caltex_bluebook_ext',
                        'rcti_coles_bluebook_ext',
                        'rcti_coles_sm_bluebook_ext',
                        'rcti_woolies_bluebook_exts',
                        'ad_custom_fields_export',
                        'customers_export',
                        'display_ads_export',
                        'insert_ads_export',
                        'online_ad_export2',
                        'order_custom_fields_export',
                        'order_export2',
                        'order_item_audience_segment',
                        'order_item_metadata',
                        'order_item_price_item',
                        'order_items')
   GROUP BY table_catalog,
            table_schema,
            TABLE_NAME)
SELECT 'SIT-prod' AS scenario,
       TABLE_NAME,
       CONCAT('SELECT "', TABLE_NAME, '" AS table_name, ', columns, ' FROM `', 'ncau-data-newsquery-sit', '.', 'sdm_rcti_nq', '.', TABLE_NAME, '` ', 'WHERE dw_partition_date BETWEEN "', '2026-02-16', '" AND "', '2026-02-16', '" ', ' EXCEPT DISTINCT ', 'SELECT "', TABLE_NAME, '" AS table_name, ', columns, ' FROM `', 'ncau-data-newsquery-prd', '.', 'sdm_rcti', '.', TABLE_NAME, '` ', 'WHERE dw_partition_date BETWEEN "', '2026-02-16', '" AND "', '2026-02-16', '";') AS testcase
FROM table_info
UNION ALL
SELECT 'prod-SIT' AS scenario,
       TABLE_NAME,
       CONCAT('SELECT "', TABLE_NAME, '" AS table_name, ', columns, ' FROM `', 'ncau-data-newsquery-prd', '.', 'sdm_rcti', '.', TABLE_NAME, '` ', 'WHERE dw_partition_date BETWEEN "', '2026-02-16', '" AND "', '2026-02-16', '" ', ' EXCEPT DISTINCT ', 'SELECT "', TABLE_NAME, '" AS table_name, ', columns, ' FROM `', 'ncau-data-newsquery-sit', '.', 'sdm_rcti_nq', '.', TABLE_NAME, '` ', 'WHERE dw_partition_date BETWEEN "', '2026-02-16', '" AND "', '2026-02-16', '";') AS testcase
FROM table_info
ORDER BY TABLE_NAME;
2026-02-17 14:16:57,642 | INFO    | RUN_QUERY | ‚úÖ Running testcases for tables starting with ''
2026-02-17 14:16:57,643 | INFO    | RUN_QUERY | Executing EXCEPT DISTINCT testcases...

2026-02-17 14:16:59,884 | INFO    | RUN_QUERY | ‚úî Testcase passed ‚Üí no differences found
2026-02-17 14:17:26,101 | INFO    | RUN_QUERY | ‚ùå Testcase failed ‚Üí 93164 differing row(s) found
2026-02-17 14:17:27,955 | INFO    | RUN_QUERY | ‚úî Testcase passed ‚Üí no differences found
2026-02-17 14:17:32,445 | INFO    | RUN_QUERY | ‚ùå Testcase failed ‚Üí 9772 differing row(s) found
2026-02-17 14:17:34,137 | INFO    | RUN_QUERY | ‚úî Testcase passed ‚Üí no differences found
2026-02-17 14:17:35,893 | INFO    | RUN_QUERY | ‚úî Testcase passed ‚Üí no differences found
2026-02-17 14:17:37,616 | INFO    | RUN_QUERY | ‚úî Testcase passed ‚Üí no differences found
2026-02-17 14:17:41,417 | INFO    | RUN_QUERY | ‚ùå Testcase failed ‚Üí 9167 differing row(s) found
2026-02-17 14:17:43,114 | INFO    | RUN_QUERY | ‚úî Testcase passed ‚Üí no differences found
2026-02-17 14:17:48,817 | INFO    | RUN_QUERY | ‚ùå Testcase failed ‚Üí 11486 differing row(s) found
2026-02-17 14:17:48,839 | INFO    | RUN_QUERY | 
üìÅ Filtered dataset results saved: output/testcase_results\sdm_rcti_except_distinct_deltaload_20260217_141654_filtered_tables_result.csv
2026-02-17 14:17:48,840 | INFO    | RUN_QUERY | Finished query: except_distinct_deltaload in 54.13s ‚Üí output/testcase_results\sdm_rcti_except_distinct_deltaload_20260217_141654.csv
2026-02-17 14:17:48,841 | INFO    | RUN_QUERY | All queries completed successfully
2026-02-17 14:18:28,128 | INFO    | RUN_QUERY | Starting query execution framework...

2026-02-17 14:18:38,617 | INFO    | RUN_QUERY | 
Running query: count
2026-02-17 14:18:38,744 | INFO    | RUN_QUERY | ‚ñ∂ Generated SQL:
WITH prod AS
  (SELECT TABLE_NAME,
          PARSE_DATE('%Y%m%d', partition_id) AS partition_date,
          total_rows
   FROM `ncau-data-newsquery-prd.sdm_optima_dgw.INFORMATION_SCHEMA.PARTITIONS`
   WHERE partition_id NOT LIKE '%NULL%'
     AND PARSE_DATE('%Y%m%d', partition_id) BETWEEN DATE('2026-02-16') AND DATE('2026-02-16')),
     prod_nq AS
  (SELECT TABLE_NAME,
          PARSE_DATE('%Y%m%d', partition_id) AS partition_date,
          total_rows
   FROM `ncau-data-newsquery-sit.sdm_optima.INFORMATION_SCHEMA.PARTITIONS`
   WHERE partition_id NOT LIKE '%NULL%'
     AND PARSE_DATE('%Y%m%d', partition_id) BETWEEN DATE('2026-02-16') AND DATE('2026-02-16')),
     info_table AS
  (SELECT TABLE_NAME
   FROM `ncau-data-newsquery-sit.sdm_optima.INFORMATION_SCHEMA.TABLES`)
SELECT i.table_name,
       a.partition_date AS sit_prtn_date,
       b.partition_date AS prd_prtn_date,
       a.total_rows AS sit_count,
       b.total_rows AS prd_count,
       a.total_rows - b.total_rows AS diff
FROM info_table i
LEFT JOIN prod_nq a ON i.table_name = a.table_name
LEFT JOIN prod b ON i.table_name = b.table_name
WHERE i.table_name NOT IN ('cart',
                           'order')
ORDER BY 1,
         3;
2026-02-17 14:18:43,973 | WARNING | RUN_QUERY | ‚ùå DIFF FOUND in count query
2026-02-17 14:18:43,973 | INFO    | RUN_QUERY | Finished query: count in 5.35s ‚Üí output/testcase_results\sdm_optima_dgw_count_20260217_141838.csv
2026-02-17 14:18:43,975 | INFO    | RUN_QUERY | All queries completed successfully
2026-02-17 14:19:06,384 | INFO    | RUN_QUERY | Starting query execution framework...

2026-02-17 14:19:14,981 | INFO    | RUN_QUERY | 
Running query: except_distinct_deltaload
2026-02-17 14:19:15,119 | INFO    | RUN_QUERY | ‚ñ∂ Generated SQL:
WITH table_info AS
  (SELECT table_catalog,
          table_schema,
          TABLE_NAME,
          STRING_AGG(CONCAT('`', COLUMN_NAME, '`'), ','
                     ORDER BY ordinal_position) AS columns
   FROM `ncau-data-newsquery-prd.sdm_optima_dgw.INFORMATION_SCHEMA.COLUMNS`
   WHERE COLUMN_NAME NOT IN ('nq_batch_id',
                             'dgw_batch_id',
                             'dw_batch_id',
                             'dw_ingest_time',
                             'dw_partition_date',
                             'dw_publish_time',
                             'dw_source_object_name',
                             'soft_error_fields',
                             'extra_data_payload')
     AND TABLE_NAME NOT IN ('appc_send_log',
                            'appc_send_log_0715',
                            'contactsf',
                            'emailobject',
                            'pushmessagedetail',
                            'smsdetailsummary',
                            'cart',
                            'order')
     AND TABLE_NAME IN ('customer',
                        'customer_address',
                        'customer_address_ext',
                        'customer_ext',
                        'demographic',
                        'news_customer_contract',
                        'news_demographic_ex',
                        'news_ext_customer_redemption',
                        'news_financial_transaction',
                        'news_interactions',
                        'news_payment_account_ext',
                        'order_item',
                        'order_item_ext',
                        'order_item_note',
                        'paybreak',
                        'payment',
                        'payment_account',
                        'payment_reversed_payment',
                        'service',
                        'service_ext',
                        'gbaba_act_xref',
                        'audit_extract',
                        'pagination_extract',
                        'payonscan_bluebook_ext',
                        'rcti_7eleven_bluebook_ext',
                        'rcti_caltex_bluebook_ext',
                        'rcti_coles_bluebook_ext',
                        'rcti_coles_sm_bluebook_ext',
                        'rcti_woolies_bluebook_exts',
                        'ad_custom_fields_export',
                        'customers_export',
                        'display_ads_export',
                        'insert_ads_export',
                        'online_ad_export2',
                        'order_custom_fields_export',
                        'order_export2',
                        'order_item_audience_segment',
                        'order_item_metadata',
                        'order_item_price_item',
                        'order_items')
   GROUP BY table_catalog,
            table_schema,
            TABLE_NAME)
SELECT 'SIT-prod' AS scenario,
       TABLE_NAME,
       CONCAT('SELECT "', TABLE_NAME, '" AS table_name, ', columns, ' FROM `', 'ncau-data-newsquery-sit', '.', 'sdm_optima', '.', TABLE_NAME, '` ', 'WHERE dw_partition_date BETWEEN "', '2026-02-16', '" AND "', '2026-02-16', '" ', ' EXCEPT DISTINCT ', 'SELECT "', TABLE_NAME, '" AS table_name, ', columns, ' FROM `', 'ncau-data-newsquery-prd', '.', 'sdm_optima_dgw', '.', TABLE_NAME, '` ', 'WHERE dw_partition_date BETWEEN "', '2026-02-16', '" AND "', '2026-02-16', '";') AS testcase
FROM table_info
UNION ALL
SELECT 'prod-SIT' AS scenario,
       TABLE_NAME,
       CONCAT('SELECT "', TABLE_NAME, '" AS table_name, ', columns, ' FROM `', 'ncau-data-newsquery-prd', '.', 'sdm_optima_dgw', '.', TABLE_NAME, '` ', 'WHERE dw_partition_date BETWEEN "', '2026-02-16', '" AND "', '2026-02-16', '" ', ' EXCEPT DISTINCT ', 'SELECT "', TABLE_NAME, '" AS table_name, ', columns, ' FROM `', 'ncau-data-newsquery-sit', '.', 'sdm_optima', '.', TABLE_NAME, '` ', 'WHERE dw_partition_date BETWEEN "', '2026-02-16', '" AND "', '2026-02-16', '";') AS testcase
FROM table_info
ORDER BY TABLE_NAME;
2026-02-17 14:19:17,942 | INFO    | RUN_QUERY | ‚úÖ Running testcases for tables starting with ''
2026-02-17 14:19:17,942 | INFO    | RUN_QUERY | Executing EXCEPT DISTINCT testcases...

2026-02-17 14:19:20,280 | INFO    | RUN_QUERY | ‚ùå Testcase failed ‚Üí 1677 differing row(s) found
2026-02-17 14:19:22,120 | INFO    | RUN_QUERY | ‚úî Testcase passed ‚Üí no differences found
2026-02-17 14:19:23,168 | WARNING | RUN_QUERY | ‚è≥ Timeout or API error: 400 Column 6 in EXCEPT DISTINCT has incompatible types: DATE, INT64 at [1:389]; reason: invalidQuery, location: query, message: Column 6 in EXCEPT DISTINCT has incompatible types: DATE, INT64 at [1:389]

Location: US
Job ID: cbc90466-725f-4fe3-b3eb-b765c4eff9c3

2026-02-17 14:19:24,376 | WARNING | RUN_QUERY | ‚è≥ Timeout or API error: 400 Column 6 in EXCEPT DISTINCT has incompatible types: INT64, DATE at [1:385]; reason: invalidQuery, location: query, message: Column 6 in EXCEPT DISTINCT has incompatible types: INT64, DATE at [1:385]

Location: US
Job ID: 9c1431af-faf5-4a90-9f5a-0a2f73d0da22

2026-02-17 14:19:24,391 | INFO    | RUN_QUERY | 
üìÅ Filtered dataset results saved: output/testcase_results\sdm_optima_dgw_except_distinct_deltaload_20260217_141914_filtered_tables_result.csv
2026-02-17 14:19:24,392 | INFO    | RUN_QUERY | Finished query: except_distinct_deltaload in 9.41s ‚Üí output/testcase_results\sdm_optima_dgw_except_distinct_deltaload_20260217_141914.csv
2026-02-17 14:19:24,393 | INFO    | RUN_QUERY | All queries completed successfully
